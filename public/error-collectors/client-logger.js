!function(t){var e={};function n(o){if(e[o])return e[o].exports;var r=e[o]={i:o,l:!1,exports:{}};return t[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(o,r,function(e){return t[e]}.bind(null,r));return o},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){var o,r,i;o=n(1),r={nco:"nonConfig",co:"choice",col:"collection"},(i=new o(function(){var t=document.location.pathname,e={app:"home-app",context:"client-errors",loggerurl:"/electrode/api/logger"};if(t&&t.match(/search/)||t.match(/browse/))e.app="search-app",e.loggerurl="/search/api/logger";else if(t&&t.match(/ip/)||t.match(/product/))e.app="product-app",e.loggerurl="/product/electrode/api/logger";else if(t&&t.match(/(co|nco|col)/)){var n=t.split("/")[1],o=r[n]||"electrode";e.app="".concat(o,"-app"),e.loggerurl="/".concat(o,"/api/logger")}return e}())).init(),window.addEventListener("unload",i.uploadLogs.bind(i),!1)},function(t,e,n){function o(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if(!(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)))return;var n=[],o=!0,r=!1,i=void 0;try{for(var a,c=t[Symbol.iterator]();!(o=(a=c.next()).done)&&(n.push(a.value),!e||n.length!==e);o=!0);}catch(t){r=!0,i=t}finally{try{o||null==c.return||c.return()}finally{if(r)throw i}}return n}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var a=n(2),c=a.console,s=(a.TouchList,a.JSON),l=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.logs=[],this.filter=["/tealeaf/","/logger/"],this.context=e||{app:"default",context:"client-errors",loggerurl:"/electrode/api/logger"},this.maxMsgs=0,this.verboseLog=!0,this.tags=["warn","splunk","logmon"],this.timeline=[]}var e,n,a;return e=t,(n=[{key:"deriveClickTimeline",value:function(){var t=this;window.addEventListener("click",(function(e){var n="".concat(e.target.tagName,' > ".').concat(e.target.className,'" | "').concat(e.target.innerText.substring(0,10),'"');t.timeline.push(n),c.log(n)}))}},{key:"addLog",value:function(t,e){var n={type:e,message:t,ts:(new Date).toString(),timeline:this.timeline};this.timeline=[],this.logs.push(n),c.log("---------------"),c.log(n),c.log("---------------")}},{key:"getMethod",value:function(t){return t.length>1&&t[1].method?t[1].method:"GET"}},{key:"spyConsole",value:function(t,e){var n=this;return function(){var o=[].slice.call(arguments).map((function(t){return"object"===r(t)&&(t=s.stringify(t)),t})).toString();return n.addLog(o,e),t.apply(this,arguments)}}},{key:"spyFetch",value:function(t){var e=this;return function(){var n=arguments;return t.apply(this,arguments).then((function(t){return 200==t.status||e.filter.some((function(e){return t.url.match(e)}))||(e.getMethod([].slice(n)),t.url,t.status,e.addLog({url:n[0],method:n[1].method||{},body:n[1].body||{}},"FETCH_ERROR")),t})).catch((function(t){return e.addLog("".concat(n[0]," ").concat(t),"FETCH_ERROR"),t}))}}},{key:"spyXMLHttpRequest",value:function(){var t=XMLHttpRequest.prototype.open,e=this,n=function(t,n,o,r){e.addLog("".concat(o," ").concat(r," ").concat(t),n)};XMLHttpRequest.prototype.open=function(){var r=this,i=arguments;this.addEventListener("load",(function(t){if(4===r.readyState&&200!==r.status){var a=o(i,2),c=a[0],s=a[1];e.filter.some((function(t){return s.match(t)}))||n(r.status,"XMLHttpRequest_Error",c,s)}})),this.addEventListener("error",(function(t){n(this.status,"XMLHttpRequest_Error")})),this.addEventListener("abort",(function(t){n(this.status,"XMLHttpRequest_Abort")})),t.apply(this,arguments)}}},{key:"spyJS",value:function(t){var e=this;t.addEventListener("error",(function(t){var n=t.message,o=t.source,r=t.lineno,i=t.colno,a=t.error,c=a&&a.stack?"error: ".concat(a.stack.substring(0,300),","):void 0,s="msg: ".concat(n,", ").concat(c," source: ").concat(o,", lineno: ").concat(r,", colno: ").concat(i);s&&e.addLog(s,"JS_Runtime_Error")})),t.addEventListener("unhandledrejection",(function(t){t.reason&&e.addLog(t.reason,"Unhandled_Rejection_Error")})),t.document.addEventListener("error",(function(t){t.target.src&&e.addLog(t.target.src,"Resource_Load_Error")}))}},{key:"spyConsoleMessages",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];c.error=this.spyConsole(c.error,"Console_Error"),t&&(c.warn=this.spyConsole(c.warn,"Console_Warning"))}},{key:"uploadLogs",value:function(){if(0!=this.logs.length){var t=this.context.loggerurl,e=this.logs.splice(0,this.maxMsgs+1),n=s.stringify({tags:this.tags,data:{type:"APP_ERROR",app:this.context.app,messages:e,$:{verbose:this.verboseLog}}});if(c.log("uploading logs ",n),"function"==typeof fetch)fetch(t,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",Accept:"application/json"},body:n}).then((function(t){c.log(" sent logs ",t.status)})).catch((function(t){c.log(" error sending logs ")}));else try{var o=new XMLHttpRequest;o.setRequestHeader("Content-Type","application/json"),o.setRequestHeader("Accept","application/json"),o.open("POST",t,!1),o.send(n)}catch(t){}}}},{key:"init",value:function(){this.deriveClickTimeline(),this.spyConsoleMessages(!1),this.spyJS(window),fetch=this.spyFetch(fetch),this.spyXMLHttpRequest(),c.log("logging activated")}}])&&i(e.prototype,n),a&&i(e,a),t}();t.exports=l},function(t,e,n){"use strict";(function(e){t.exports="object"==typeof self&&self.self===self&&self||"object"==typeof e&&e.global===e&&e||this}).call(this,n(3))},function(t,e){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(t){"object"==typeof window&&(n=window)}t.exports=n}]);
//# sourceMappingURL=client-logger.js.map